<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Design ideas &mdash; pyro 4.1.0.post14+g0d61534f documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=2e394b92" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=fcdc5f00"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running" href="running.html" />
    <link rel="prev" title="Notes on the numerical methods" href="notes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pyro
              <img src="_static/logo.gif" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">pyro basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to pyro</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Setting up pyro</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes.html">Notes on the numerical methods</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design ideas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#directory-structure">Directory structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pyro"><code class="docutils literal notranslate"><span class="pre">pyro/</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numba">Numba</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-driver">Main driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Working with output</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Adding a problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_basics.html">Mesh overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh-examples.html">Mesh examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh-examples.html#Spherical-Polar-Grid">Spherical Polar Grid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="advection_basics.html">Advection solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="burgers_basics.html">Burgers’ Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="compressible_basics.html">Compressible hydrodynamics solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="compressible_compare.html">Compressible solver comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="multigrid.html">Multigrid Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion_basics.html">Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="incompressible_basics.html">Incompressible hydrodynamics solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="incompressible_viscous_basics.html">Incompressible viscous hydrodynamics solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowmach_basics.html">Low Mach number hydrodynamics solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="swe_basics.html">Shallow water solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles_basics.html">Particles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="help.html">Contributing and getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="ack.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="ack.html#history">History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Design ideas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="design-ideas">
<h1>Design ideas<a class="headerlink" href="#design-ideas" title="Link to this heading"></a></h1>
<p>pyro is written entirely in python (by default, we expect python 3),
with a few low-level routines compiled <em>just-in-time</em> by <cite>numba</cite> for performance. The
<code class="docutils literal notranslate"><span class="pre">numpy</span></code> package is used for representing arrays throughout the
python code and the <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> library is used for
visualization. Finally, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is used for unit testing of some
components.</p>
<p>All solvers are written for a 2-d grid.  This gives a good balance
between complexity and speed.</p>
<p>A paper describing the design philosophy of pyro was accepted to
Astronomy &amp; Computing <a class="reference external" href="http://adsabs.harvard.edu/abs/2013arXiv1306.6883Z">[paper link]</a>.</p>
<section id="directory-structure">
<h2>Directory structure<a class="headerlink" href="#directory-structure" title="Link to this heading"></a></h2>
<p>pyro follows a standard python package structure.  The main directory
(called <code class="docutils literal notranslate"><span class="pre">pyro2/</span></code> for historical reasons) contains:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docs/</span></code> : The documentation in Sphinx format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples/</span></code> : Some example notebooks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paper/</span></code> : the original JOSS paper</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">presentations/</span></code> : some presentations given on pyro in the past</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyro/</span></code> : the main source directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">www/</span></code> : the logo used in the website</p></li>
</ul>
<p>It is at this level (<code class="docutils literal notranslate"><span class="pre">pyro2/</span></code>) that the installation of pyro is done (via <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>).</p>
<section id="pyro">
<h3><code class="docutils literal notranslate"><span class="pre">pyro/</span></code><a class="headerlink" href="#pyro" title="Link to this heading"></a></h3>
<p>The main code is all contained in the <code class="docutils literal notranslate"><span class="pre">pyro/</span></code> subdirectory.  Here we discuss that.</p>
<p>The files for each solver are in their own sub-directory, with
additional sub-directories for the mesh and utilities. Each solver has
two sub-directories: <code class="docutils literal notranslate"><span class="pre">problems/</span></code> and <code class="docutils literal notranslate"><span class="pre">tests/</span></code>. These store the
different problem setups for the solver and reference output for
testing.</p>
<p>The overall structure is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">advection/</span></code>: The linear advection equation solver using the CTU
method. All advection-specific routines live here.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the advection solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference advection output files for comparison and regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">advection_fv4/</span></code>: The fourth-order accurate finite-volume advection
solver that uses RK4 time integration.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the fourth-order advection solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference advection output files for comparison and regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">advection_nonuniform/</span></code>: The solver for advection with a non-uniform velocity field.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the non-uniform advection solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference advection output files for comparison and regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">advection_rk/</span></code>: The linear advection equation solver using the
method-of-lines approach.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: This is a symbolic link to the advection/problems/ directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference advection output files for comparison and regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">advection_weno/</span></code>: The method-of-lines WENO solver for linear
advection.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: This is a symbolic link to the advection/problems/ directory.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">analysis/</span></code>: Various analysis scripts for processing pyro output files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compressible/</span></code>: The fourth-order accurate finite-volume compressible
hydro solver that uses RK4 time integration.  This is built from the
method of McCourquodale and Colella (2011).</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the fourth-order compressible hydrodynamics solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference compressible hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compressible_fv4/</span></code>: The compressible hydrodynamics solver using the
CTU method. All source files specific to this solver live here.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: This is a symbolic link to the compressible/problems/ directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference compressible hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compressible_rk/</span></code>: The compressible hydrodynamics solver using method of lines integration.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: This is a symbolic link to the compressible/problems/ directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference compressible hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compressible_sdc/</span></code>: The fourth-order compressible solver,
using spectral-deferred correction (SDC) for the time integration.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: This is a symbolic link to the compressible/problems/ directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference compressible hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">diffusion/</span></code>: The implicit (thermal) diffusion solver. All diffusion-specific routines live here.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the diffusion solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference diffusion output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">incompressible/</span></code>: The incompressible hydrodynamics solver. All incompressible-specific routines live here.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the incompressible solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>:  Reference incompressible hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lm_atm/</span></code>: The low Mach number hydrodynamics solver for atmospherical flows. All low-Mach-specific files live here.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the low Mach number solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference low Mach hydro output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mesh/</span></code>: The main classes that deal with 2-d cell-centered grids
and the data that lives on them. All the solvers use these classes
to represent their discretized data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multigrid/</span></code>: The multigrid solver for cell-centered data. This
solver is used on its own to illustrate how multigrid works, and
directly by the diffusion and incompressible solvers.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for when the multigrid solver is used in a stand-alone fashion.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference multigrid solver solutions (from when the multigrid solver is used stand-alone) for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">particles/</span></code>: The solver for Lagrangian tracer particles.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Particle solver testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">swe/</span></code>: The shallow water solver.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">problems/</span></code>: The problem setups for the shallow water solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/</span></code>: Reference shallow water output for regression testing.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">util/</span></code>: Various service modules used by the pyro routines,
including runtime parameters, I/O, profiling, and pretty output
modes.</p></li>
</ul>
</section>
</section>
<section id="numba">
<h2>Numba<a class="headerlink" href="#numba" title="Link to this heading"></a></h2>
<p>Numba is used to speed up some critical portions of the code. Numba is
a <em>just-in-time compiler</em> for python. When a call is first made to a
function decorated with Numba’s <code class="docutils literal notranslate"><span class="pre">&#64;njit</span></code> decorator, it is compiled to
machine code ‘just-in-time’ for it to be executed. Once compiled, it
can then run at (near-to) native machine code speed.</p>
<p>We also use Numba’s <code class="docutils literal notranslate"><span class="pre">cache=True</span></code> option, which means that once the
code is compiled, Numba will write the code into a file-based cache. The next
time you run the same bit of code, Numba will use the saved version rather than
compiling the code again, saving some compilation time at the start of the
simulation.</p>
</section>
<section id="main-driver">
<h2>Main driver<a class="headerlink" href="#main-driver" title="Link to this heading"></a></h2>
<p>All the solvers use the same driver, the main <code class="docutils literal notranslate"><span class="pre">pyro_sim.py</span></code> script,
contained in <code class="docutils literal notranslate"><span class="pre">pyro2/pyro/</span></code>. The flowchart for the driver is:</p>
<ul class="simple">
<li><p>parse runtime parameters</p></li>
<li><p>setup the grid (<code class="docutils literal notranslate"><span class="pre">initialize()</span></code> function from the solver)</p>
<ul>
<li><p>initialize the data for the desired problem (<code class="docutils literal notranslate"><span class="pre">init_data()</span></code> function from the problem)</p></li>
</ul>
</li>
<li><p>do any necessary pre-evolution initialization (<code class="docutils literal notranslate"><span class="pre">preevolve()</span></code> function from the solver)</p></li>
<li><p>evolve while t &lt; tmax and n &lt; max_steps</p>
<ul>
<li><p>fill boundary conditions (<code class="docutils literal notranslate"><span class="pre">fill_BC_all()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">CellCenterData2d</span></code> class)</p></li>
<li><p>get the timestep (<code class="docutils literal notranslate"><span class="pre">compute_timestep()</span></code> calls the solver’s <code class="docutils literal notranslate"><span class="pre">method_compute_timestep()</span></code> function from the solver)</p></li>
<li><p>evolve for a single timestep (<code class="docutils literal notranslate"><span class="pre">evolve()</span></code> function from the solver)</p></li>
<li><p>t = t + dt</p></li>
<li><p>output (<code class="docutils literal notranslate"><span class="pre">write()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">CellCenterData2d</span></code> class)</p></li>
<li><p>visualization (<code class="docutils literal notranslate"><span class="pre">dovis()</span></code> function from the solver)</p></li>
</ul>
</li>
<li><p>call the solver’s <code class="docutils literal notranslate"><span class="pre">finalize()</span></code> function to output any useful information at the end</p></li>
</ul>
<p>This format is flexible enough for the advection, compressible,
diffusion, and incompressible evolution solver. Each solver provides a
<code class="docutils literal notranslate"><span class="pre">Simulation</span></code> class that provides the following methods (note:
inheritance is used, so many of these methods come from the base
<code class="docutils literal notranslate"><span class="pre">NullSimulation</span></code> class):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">compute_timestep</span></code>: return the timestep based on the solver’s
specific needs (through <code class="docutils literal notranslate"><span class="pre">method_compute_timestep()</span></code>) and
timestepping parameters in the driver</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dovis</span></code>: performs visualization of the current solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evolve</span></code>: advances the system of equations through a single timestep</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finalize</span></code>: any final clean-ups, printing of analysis hints.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finished</span></code>: return True if we’ve met the stopping criteria for a simulation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">initialize</span></code>: sets up the grid and solution variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_compute_timestep</span></code>: returns the timestep for evolving the system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preevolve</span></code>: does any initialization to the fluid state that is necessary before the main evolution. Not every solver will need something here.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_extras</span></code>: read in any solver-specific data from a stored output file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write</span></code>: write the state of the simulation to an HDF5 file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write_extras</span></code>: any solver-specific writing</p></li>
</ul>
<p>Each problem setup needs only provide an <code class="docutils literal notranslate"><span class="pre">init_data()</span></code> function that fills the data in the patch object.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="notes.html" class="btn btn-neutral float-left" title="Notes on the numerical methods" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="running.html" class="btn btn-neutral float-right" title="Running" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, pyro development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>